<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>éŸ³æ¨‚é€£å‹•æ¸¬è©¦</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #333;
      border-radius: 8px;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      background: #333;
    }
    .success { background: #28a745; }
    .error { background: #dc3545; }
    .info { background: #17a2b8; }
  </style>
</head>
<body>
  <h1>ğŸµ éŸ³æ¨‚é€£å‹•ç³»çµ±æ¸¬è©¦</h1>
  
  <div class="test-section">
    <h3>ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h3>
    <div id="systemStatus" class="status info">æª¢æŸ¥ä¸­...</div>
    <button onclick="checkSystemStatus()">é‡æ–°æª¢æŸ¥</button>
  </div>
  
  <div class="test-section">
    <h3>éŸ³æ¨‚æ§åˆ¶</h3>
    <button onclick="testPlay()">æ’­æ”¾éŸ³æ¨‚</button>
    <button onclick="testPause()">æš«åœéŸ³æ¨‚</button>
    <button onclick="testToggle()">åˆ‡æ›éŸ³æ¨‚</button>
    <div id="musicStatus" class="status info">ç­‰å¾…æ¸¬è©¦...</div>
  </div>
  
  <div class="test-section">
    <h3>LinkageSystem æ¸¬è©¦</h3>
    <button onclick="testLinkageSystem()">æ¸¬è©¦ LinkageSystem</button>
    <div id="linkageStatus" class="status info">ç­‰å¾…æ¸¬è©¦...</div>
  </div>
  
  <div class="test-section">
    <h3>SoundSystem æ¸¬è©¦</h3>
    <button onclick="testSoundSystem()">æ¸¬è©¦ SoundSystem</button>
    <div id="soundStatus" class="status info">ç­‰å¾…æ¸¬è©¦...</div>
  </div>
  
  <div class="test-section">
    <h3>localStorage æ¸¬è©¦</h3>
    <button onclick="testLocalStorage()">æ¸¬è©¦ localStorage</button>
    <div id="storageStatus" class="status info">ç­‰å¾…æ¸¬è©¦...</div>
  </div>
  
  <div class="test-section">
    <h3>è¨ºæ–·å·¥å…·</h3>
    <button onclick="runFullDiagnostic()">å®Œæ•´è¨ºæ–·</button>
    <button onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
    <div id="diagnosticResult" class="status info">ç­‰å¾…è¨ºæ–·...</div>
  </div>

  <!-- éŸ³æ¨‚å…ƒç´  -->
  <audio id="backgroundMusic" loop>
    <source src="sound/åˆå¾Œæ”¾é¬†æ™‚å…‰ï¼ˆç´”éŸ³æ¨‚ï¼‰.mp3" type="audio/mpeg">
  </audio>

  <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
  <script src="js/userData.js"></script>
  <script src="js/sound.js"></script>
  
  <script>
    // æ¸¬è©¦å‡½æ•¸
    function checkSystemStatus() {
      const status = document.getElementById('systemStatus');
      let html = '<h4>ç³»çµ±ç‹€æ…‹å ±å‘Šï¼š</h4>';
      
      // æª¢æŸ¥ LinkageSystem
      if (typeof LinkageSystem !== 'undefined') {
        html += '<p>âœ… LinkageSystem å·²è¼‰å…¥</p>';
        if (LinkageSystem.music) {
          html += '<p>âœ… LinkageSystem.music å¯ç”¨</p>';
        } else {
          html += '<p>âŒ LinkageSystem.music ä¸å¯ç”¨</p>';
        }
      } else {
        html += '<p>âŒ LinkageSystem æœªè¼‰å…¥</p>';
      }
      
      // æª¢æŸ¥ SoundSystem
      if (typeof SoundSystem !== 'undefined') {
        html += '<p>âœ… SoundSystem å·²è¼‰å…¥</p>';
        if (SoundSystem.bgm) {
          html += '<p>âœ… SoundSystem.bgm å¯ç”¨</p>';
        } else {
          html += '<p>âŒ SoundSystem.bgm ä¸å¯ç”¨</p>';
        }
      } else {
        html += '<p>âŒ SoundSystem æœªè¼‰å…¥</p>';
      }
      
      // æª¢æŸ¥éŸ³æ¨‚å…ƒç´ 
      const music = document.getElementById('backgroundMusic');
      if (music) {
        html += '<p>âœ… èƒŒæ™¯éŸ³æ¨‚å…ƒç´ å­˜åœ¨</p>';
        html += `<p>éŸ³æ¨‚æª”æ¡ˆ: ${music.src}</p>`;
        html += `<p>éŸ³é‡: ${music.volume}</p>`;
        html += `<p>å¾ªç’°: ${music.loop}</p>`;
        html += `<p>æš«åœç‹€æ…‹: ${music.paused}</p>`;
      } else {
        html += '<p>âŒ èƒŒæ™¯éŸ³æ¨‚å…ƒç´ ä¸å­˜åœ¨</p>';
      }
      
      status.innerHTML = html;
      status.className = 'status success';
    }
    
    function testPlay() {
      const status = document.getElementById('musicStatus');
      const music = document.getElementById('backgroundMusic');
      
      try {
        music.play().then(() => {
          status.innerHTML = 'âœ… éŸ³æ¨‚æ’­æ”¾æˆåŠŸ';
          status.className = 'status success';
        }).catch(err => {
          status.innerHTML = `âŒ éŸ³æ¨‚æ’­æ”¾å¤±æ•—: ${err.message}`;
          status.className = 'status error';
        });
      } catch (err) {
        status.innerHTML = `âŒ æ’­æ”¾å‡½æ•¸éŒ¯èª¤: ${err.message}`;
        status.className = 'status error';
      }
    }
    
    function testPause() {
      const status = document.getElementById('musicStatus');
      const music = document.getElementById('backgroundMusic');
      
      try {
        music.pause();
        status.innerHTML = 'âœ… éŸ³æ¨‚æš«åœæˆåŠŸ';
        status.className = 'status success';
      } catch (err) {
        status.innerHTML = `âŒ æš«åœå‡½æ•¸éŒ¯èª¤: ${err.message}`;
        status.className = 'status error';
      }
    }
    
    function testToggle() {
      const status = document.getElementById('musicStatus');
      const music = document.getElementById('backgroundMusic');
      
      if (music.paused) {
        testPlay();
      } else {
        testPause();
      }
    }
    
    function testLinkageSystem() {
      const status = document.getElementById('linkageStatus');
      
      if (typeof LinkageSystem !== 'undefined' && LinkageSystem.music) {
        try {
          const isPlaying = LinkageSystem.music.isPlaying();
          const volume = LinkageSystem.music.getVolume();
          
          status.innerHTML = `
            âœ… LinkageSystem æ¸¬è©¦æˆåŠŸ<br>
            æ’­æ”¾ç‹€æ…‹: ${isPlaying}<br>
            éŸ³é‡: ${volume}
          `;
          status.className = 'status success';
        } catch (err) {
          status.innerHTML = `âŒ LinkageSystem æ¸¬è©¦å¤±æ•—: ${err.message}`;
          status.className = 'status error';
        }
      } else {
        status.innerHTML = 'âŒ LinkageSystem ä¸å¯ç”¨';
        status.className = 'status error';
      }
    }
    
    function testSoundSystem() {
      const status = document.getElementById('soundStatus');
      
      if (typeof SoundSystem !== 'undefined' && SoundSystem.bgm) {
        try {
          const isPlaying = SoundSystem.bgm.getPlayingState();
          const volume = SoundSystem.bgm.getVolume();
          
          status.innerHTML = `
            âœ… SoundSystem æ¸¬è©¦æˆåŠŸ<br>
            æ’­æ”¾ç‹€æ…‹: ${isPlaying}<br>
            éŸ³é‡: ${volume}
          `;
          status.className = 'status success';
        } catch (err) {
          status.innerHTML = `âŒ SoundSystem æ¸¬è©¦å¤±æ•—: ${err.message}`;
          status.className = 'status error';
        }
      } else {
        status.innerHTML = 'âŒ SoundSystem ä¸å¯ç”¨';
        status.className = 'status error';
      }
    }
    
    function testLocalStorage() {
      const status = document.getElementById('storageStatus');
      
      try {
        const musicState = localStorage.getItem('bgMusicState');
        const musicVolume = localStorage.getItem('musicVolume');
        
        status.innerHTML = `
          âœ… localStorage æ¸¬è©¦æˆåŠŸ<br>
          éŸ³æ¨‚ç‹€æ…‹: ${musicState || 'æœªè¨­å®š'}<br>
          éŸ³æ¨‚éŸ³é‡: ${musicVolume || 'æœªè¨­å®š'}
        `;
        status.className = 'status success';
      } catch (err) {
        status.innerHTML = `âŒ localStorage æ¸¬è©¦å¤±æ•—: ${err.message}`;
        status.className = 'status error';
      }
    }
    
    function runFullDiagnostic() {
      const result = document.getElementById('diagnosticResult');
      let html = '<h4>å®Œæ•´è¨ºæ–·å ±å‘Šï¼š</h4>';
      
      // æª¢æŸ¥æ‰€æœ‰ç³»çµ±
      checkSystemStatus();
      testLinkageSystem();
      testSoundSystem();
      testLocalStorage();
      
      // æª¢æŸ¥éŸ³æ¨‚æª”æ¡ˆ
      const music = document.getElementById('backgroundMusic');
      if (music) {
        music.addEventListener('canplaythrough', () => {
          html += '<p>âœ… éŸ³æ¨‚æª”æ¡ˆå¯ä»¥æ’­æ”¾</p>';
          result.innerHTML = html;
          result.className = 'status success';
        });
        
        music.addEventListener('error', (e) => {
          html += '<p>âŒ éŸ³æ¨‚æª”æ¡ˆè¼‰å…¥å¤±æ•—</p>';
          result.innerHTML = html;
          result.className = 'status error';
        });
        
        // å˜—è©¦è¼‰å…¥éŸ³æ¨‚
        music.load();
      }
      
      result.innerHTML = html;
      result.className = 'status info';
    }
    
    function clearAllData() {
      try {
        localStorage.removeItem('bgMusicState');
        localStorage.removeItem('musicVolume');
        document.getElementById('diagnosticResult').innerHTML = 'âœ… æ‰€æœ‰éŸ³æ¨‚ç›¸é—œæ•¸æ“šå·²æ¸…é™¤';
        document.getElementById('diagnosticResult').className = 'status success';
      } catch (err) {
        document.getElementById('diagnosticResult').innerHTML = `âŒ æ¸…é™¤æ•¸æ“šå¤±æ•—: ${err.message}`;
        document.getElementById('diagnosticResult').className = 'status error';
      }
    }
    
    // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
    window.addEventListener('load', () => {
      setTimeout(checkSystemStatus, 1000);
    });
  </script>
</body>
</html> 